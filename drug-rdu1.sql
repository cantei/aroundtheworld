# HDC 
SELECT  t1.HOSPCODE,t1.PID,t1.SEQ,t1.DATE_SERV
-- ,t2.DIDSTD
-- ,GROUP_CONCAT(t1.DIAGCODE ) AS DX
,GROUP_CONCAT(t2.DIDSTD) AS DRUG_ID
FROM diagnosis_opd t1 
LEFT JOIN drug_opd t2
ON t1.HOSPCODE=t2.HOSPCODE AND t1.PID=t2.PID AND t1.SEQ=t2.SEQ 

WHERE
 EXISTS (SELECT *  FROM c_antibioticss WHERE substr(t2.DIDSTD,1,19)=c_antibioticss.stdcode )

AND  t1.DATE_SERV BETWEEN '2016-10-01' AND '2017-10-31'
AND   SUBSTR(t1.DIAGCODE,1,4) IN ("H650","H651","H659","H660","H664","H669", "H670","H671","H678","H720","H721",
"H722","H728","H729","J00","J010","J011","J012","J013","J014","J018","J019", 
 "J020","J029","J030","J038","J039","J040","J041","J042","J050","J051","J060","J068","J069", 
 "J101","J111","J200","J201","J202","J203","J204","J205","J206","J207","J208","J209","J210","J218","J219")
AND t1.DIAGTYPE in (1,2,3,4,5,6,7)
-- AND t1.HOSPCODE='07718'

GROUP BY   t1.HOSPCODE,t1.PID,t1.SEQ
HAVING LENGTH(GROUP_CONCAT(t2.DIDSTD)) > 24
